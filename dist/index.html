<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <meta charset="UTF-8" />
  <style>
    textarea {
      min-width: 500px;
      min-height: 300px;
    }
  </style>
</head>

<body>
  <div id="app" style="display: flex; gap: 16px;">
    <div>
      <h1>purify-html</h1>
      <a href="https://www.npmjs.com/package/purify-html">See on NPM</a>
    </div>

    <div style="display: flex; gap: 16px;">
      <div style="display: flex; flex-direction: column;">
        <strong>Input:</strong>
        <textarea id="input"></textarea>
      </div>
      <div style="display: flex; flex-direction: column;">
        <strong>Output:</strong>
        <textarea id="output"></textarea>
        <div id="unsafe-output"></div>
      </div>
    </div>
  </div>

  <script src="./index.browser.js"></script>

  <script>
    function app() {
      const inputNode = document.querySelector("#input");
      const outputNode = document.querySelector("#output");
      const unsafeOutputNode = document.querySelector("#unsafe-output");

      const sanitizeAndPaste = (str) => {
        const sanitized = sanitizer.sanitize(str);
        outputNode.value = sanitized
        unsafeOutputNode.innerHTML = sanitized;
      };

      const sanitizer = new PurifyHTML.sanitizer();
      // const sanitizer = new PurifyHTML.sanitizer([
      //   "div",
      //   {
      //     name: "b",
      //     attributes: [{ name: "data-id", value: /^[0-9]{1,3}$/ }]
      //   },
      //   {
      //     name: "img",
      //     attributes: [{ name: "src", value: /^https:\/\/.*/ }]
      //   }
      // ]);

      inputNode.addEventListener("input", () => {
        sanitizeAndPaste(inputNode.value);
      });

      // example setup
      const str = `
        <div data-id="12">div</div>
        <b class="some" data-id="123">
        <b class="some" data-data="123">
        <b class="some" data-id="1234">
        <img src="x.jpeg" onerror="alert(1)">
        <img src="https://google.com" onerror="alert(1)">
        <img src="http://google.com" onerror="alert(1)">
      `;

      inputNode.value = str;
      sanitizeAndPaste(str);
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", app);
    } else {
      app();
    }

  </script>
</body>

</html>